{% extends 'base.html' %}
{% load static %}

{% block title %}View {{ content_type|title }} - {{ job.job_id }}{% endblock %}

{% block content %}
<div class="container">
    <div class="mb-3">
        <a href="{% url 'superadmin:new_jobs' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to New Jobs
        </a>
    </div>

    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4><i class="fas fa-file-alt"></i> {{ content_type|title }} - Job {{ job.job_id }}</h4>
        </div>
        <div class="card-body">
            <!-- Job Info -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>System ID:</strong> {{ job.system_id }}
                </div>
                <div class="col-md-6">
                    <strong>Created By:</strong> {{ job.created_by.get_full_name }}
                </div>
            </div>

            <hr>

            <!-- Content Display -->
            {% if content_type == 'summary' %}
                <h5>Job Summary Details</h5>
                <p><strong>Topic:</strong> {{ content.topic }}</p>
                <p><strong>Word Count:</strong> {{ content.word_count }}</p>
                <p><strong>Reference Style:</strong> {{ content.reference_style }}</p>
                <p><strong>Writing Style:</strong> {{ content.writing_style }}</p>
                <hr>
                <h6>Summary Text:</h6>
                <div class="bg-light p-3 rounded">
                    {{ content.summary_text|linebreaks }}
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>

            {% elif content_type == 'structure' %}
                <h5>Job Structure</h5>
                <p><strong>Total Word Count:</strong> {{ content.total_word_count }}</p>
                <hr>
                <div class="bg-light p-3 rounded">
                    <pre style="white-space: pre-wrap;">{{ content.structure_text }}</pre>
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>

            {% elif content_type == 'content' %}
                <h5>Generated Content</h5>
                <p><strong>Actual Word Count:</strong> {{ content.actual_word_count }}</p>
                <hr>
                <div class="bg-light p-3 rounded" style="max-height: 600px; overflow-y: auto;">
                    {{ content.content_text|linebreaks }}
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>

            {% elif content_type == 'references' %}
                <h5>References and Citations</h5>
                <p><strong>Total References:</strong> {{ content.total_references }}</p>
                <hr>
                <h6>Reference List:</h6>
                <div class="bg-light p-3 rounded mb-3">
                    {{ content.reference_list|linebreaks }}
                </div>
                <h6>Citation List:</h6>
                <div class="bg-light p-3 rounded">
                    {{ content.citation_list|linebreaks }}
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>

            {% elif content_type == 'plagiarism' %}
                <h5>Plagiarism Report</h5>
                <p><strong>Similarity Percentage:</strong> {{ content.similarity_percentage }}%</p>
                <hr>
                <div class="bg-light p-3 rounded">
                    {{ content.report_data|linebreaks }}
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>

            {% elif content_type == 'ai_report' %}
                <h5>AI Detection Report</h5>
                <p><strong>AI Percentage:</strong> {{ content.ai_percentage }}%</p>
                <hr>
                <div class="bg-light p-3 rounded">
                    {{ content.report_data|linebreaks }}
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>

            {% elif content_type == 'full_content' %}
                <h5>Full Content with Citations</h5>
                <p><strong>Final Word Count:</strong> {{ content.final_word_count }}</p>
                <hr>
                <div class="bg-light p-3 rounded" style="max-height: 600px; overflow-y: auto;">
                    {{ content.content_with_citations|linebreaks }}
                </div>
                <p class="mt-3"><small>Generation Count: {{ content.regeneration_count }}/3</small></p>
            {% endif %}

            <!-- Action Buttons -->
            <div class="mt-4">
                {% if not content.is_approved %}
                    {% if content.can_regenerate %}
                    <a href="{% url 'ai_pipeline:ai_content_regenerate' job.job_id content_type %}" 
                       class="btn btn-warning"
                       onclick="return confirm('Regenerate this content? ({{ content.regeneration_count }}/3 attempts used)')">
                        <i class="fas fa-sync"></i> Regenerate
                    </a>
                    {% endif %}
                    <a href="{% url 'ai_pipeline:ai_content_approve' job.job_id content_type %}" 
                       class="btn btn-success"
                       onclick="return confirm('Approve this content?')">
                        <i class="fas fa-check"></i> Approve
                    </a>
                    {% else %}
                    <span class="badge bg-success p-2">
                        <i class="fas fa-check-circle"></i> Approved by {{ content.approved_by.get_full_name }}
                        on {{ content.approved_at|date:"M d, Y H:i" }}
                    </span>
                    {% endif %}
                    <a href="{% url 'ai_pipeline:download_content' job.job_id content_type %}" class="btn btn-primary">
                <i class="fas fa-download"></i> Download
            </a>
        </div>
    </div>
</div>
</div>
{% endblock %}
