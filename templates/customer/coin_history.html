{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">Your Coin History</h2>
<div class="card shadow-sm" style="background: {{ theme_color }};">
  <div class="card-body table-responsive">
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>SL No</th>
          <th>Date</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody>
        {% if transactions %}
          {% for t in transactions %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{% if t.created_at %}{{ t.created_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</td>
            <td>
              <div class="fw-semibold">{{ t.reason|default:t.get_source_display }}</div>
              <div class="text-muted small">
                {{ t.get_txn_type_display|default:t.txn_type }}
                {% if t.source %} • {{ t.get_source_display|default:t.source }}{% endif %}
                {% if t.related_object_type %} • {{ t.related_object_type }}{% endif %}
                {% if t.related_object_id %} #{{ t.related_object_id }}{% endif %}
              </div>
            </td>
            <td class="{% if t.txn_type == 'DEBIT' or t.txn_type == 'EXPIRY' %}text-danger{% else %}text-success{% endif %}">
              {% if t.txn_type == 'DEBIT' or t.txn_type == 'EXPIRY' %}-{% else %}+{% endif %}{{ t.amount }} coins
            </td>
            <td>{{ t.after_balance }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="5" class="text-center text-muted">No transactions yet.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  {% if transactions_page_obj %}
  <div class="card-footer bg-white d-flex justify-content-between align-items-center">
    <div class="text-muted small">
      Showing {{ transactions_page_obj.start_index }} - {{ transactions_page_obj.end_index }} of {{ transactions_page_obj.paginator.count }}
    </div>
    <div class="btn-group">
      {% if transactions_page_obj.has_previous %}
        <a class="btn btn-sm btn-outline-secondary" href="?page=1">&laquo;</a>
        <a class="btn btn-sm btn-outline-secondary" href="?page={{ transactions_page_obj.previous_page_number }}">&lsaquo;</a>
      {% else %}
        <span class="btn btn-sm btn-outline-secondary disabled">&laquo;</span>
        <span class="btn btn-sm btn-outline-secondary disabled">&lsaquo;</span>
      {% endif %}
      <span class="btn btn-sm btn-outline-primary disabled">
        {{ transactions_page_obj.number }} / {{ transactions_page_obj.paginator.num_pages }}
      </span>
      {% if transactions_page_obj.has_next %}
        <a class="btn btn-sm btn-outline-secondary" href="?page={{ transactions_page_obj.next_page_number }}">&rsaquo;</a>
        <a class="btn btn-sm btn-outline-secondary" href="?page={{ transactions_page_obj.paginator.num_pages }}">&raquo;</a>
      {% else %}
        <span class="btn btn-sm btn-outline-secondary disabled">&rsaquo;</span>
        <span class="btn btn-sm btn-outline-secondary disabled">&raquo;</span>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
